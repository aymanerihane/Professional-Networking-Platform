{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
@import url(https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css);
.plus-div {
    display: flex;
  justify-content: space-between;
  align-items: center;
}
.plus-btn {
   background-color: #0073b1;
  color: white;
  margin: 10px 0 20px;
  padding: 3px 5px;
  border-radius: 50%;
  font-size: 16px;
  cursor: pointer;
    
}
.overlay{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

#form-container{
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 500px;
    height: 500px;
    padding: 20px;
    background: #f4f4f4;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1001;
}
#modifie{
    display: none;

}
</style>
    <!-- navbar ended -->
    <div class="container">
        <div class="profile-main">
            <div class="profile-container">
                <img src="{% static 'PNP/img/Bgcs/backGround1.jpg' %}"
                    width="100%" class="cover-img">
                <div class="profile-container-inner">
                    {% if the_user.user.photo_profile %}
                    <img class="profile-pic" style="object-fit: cover;height: 100px;width: 95px;" src="{{ the_user.user.photo_profile.url }}" alt="">
                    {% else %}
                    <img class="profile-pic" src="{% static 'PNP/img/avatar/default.jpg' %}" alt="">
                    {% endif %}
                    {% if isMe %}
                    <div class="plus-div" id="addAbout" data-id="6">
                        <h1>{{the_user.username}}</h1>
                        <i class="fa fa-pencil edit-btn plus-btn" data-id="6"></i>
                    </div>
                    {% endif %}
                    <b>{{the_user.user.introduction}}</b>
                    <p>{{the_user.user.country}} | {{the_user.user.address}} | {{the_user.user.city}}</p>
                    <p>{{the_user.user.phone}}</p>

                    
                    {% if not isMe  and auth_user.is_authenticated %}
                    <div class="profile-btn">
                        {% if requestsend %}
                            <a style="background-color: #efefef;color:black" href="{% url 'PNP:addFriend' the_user %}"  class="primary-btn"><img src="{% static 'PNP/img/connect.png' %}" >waitting to be accepted</a>
                        {% else %}
                            {% if isFriend %}
                                <a style="background-color: #efefef;color:black" href="{% url 'PNP:addFriend' the_user %}"  class="primary-btn"><img src="{% static 'PNP/img/connect.png' %}" >unfollow </a>
                            {% else %}
                                {% if is_private %}
                                    <a href="{% url 'PNP:addFriend' the_user %}" class="primary-btn"><img src="{% static 'PNP/img/connect.png' %}" >send request</a>
                                {% else %}
                                        <a href="{% url 'PNP:addFriend' the_user %}" class="primary-btn"><img src="{% static 'PNP/img/connect.png' %}" >Connect</a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                        
                        <a href=""><img src="{% static 'PNP/img/message.png' %}" alt="">Chat</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="profile-description">
            {% if isMe %}
                <div class="plus-div" id="addAbout" data-id="0">
                <h2>About</h2>
                <i class="fa fa-pencil plus-btn" data-id="0"></i>
                </div>
            {% endif %}
                <h2>About</h2>
                <p>
                {{cv.about}}
                </p>
                {% comment %} <a class="see-more-link" onclick="show()">See <span id="more">More...</span></a> {% endcomment %}
            </div>
            
            <div class="profile-description">
            {% if isMe %}
                <div class="plus-div" id="addExperience" data-id="1">
                <h2>Experience</h2>
                <i class="fa fa-plus plus-btn" data-id="1"></i>
                </div>
            {% endif %}
            {% if cv.experiences %}
                {% for experience in cv.experiences %}
                <div class="profile-desc-row">
                    <img src="{% static 'PNP/img/microsoft.png' %}">
                    <div>
                        <h3>{{experience.job_title}}</h3>
                        <b>{{experience.company}}</b>
                        <b>{{experience.start_date}}-{{experience.end_date}}</b>
                        <p>{{experience.description}}</p>
                        <hr>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="profile-desc-row">
                <div>
                    <p>No experience available</p>
                </div>
            </div>
            {% endif %}
            </div>
            <div class="profile-description">
            {% if isMe %}
                <div class="plus-div " id="addEducation" data-id="2">
                <h2>Education</h2>
                <i class="fa fa-plus plus-btn" data-id="2"></i>
                </div>
            {% endif %}
                {% if cv.educations %}
                {% for education in cv.educations %} 
                <div class="profile-desc-row">
                    <img src="{% static 'PNP/img/microsoft.png' %}">
                    <div>
                        <h3>{{education.school}}</h3>
                        <b>{{education.degree}}</b>
                        <b>{{education.start_date}}-{{education.end_date}}</b>
                        <hr>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                    <div class="profile-desc-row">
                        <div>
                            <p>No education available</p>
                        </div>
                    </div> 
                {% endif %}
            </div>
            <div class="profile-description">
            {% if isMe %}
                <div class="plus-div" id="addSkills" data-id="3">
                <h2>Skills</h2>
                <i class="fa fa-plus plus-btn" data-id="3"></i>
                </div>
            {% endif %}
                {% if cv.skills %}
               <div> {% for skill in cv.skills %}
                    <div class="skill-btn">{{skill}}</div>{% if not forloop.last %} {% endif %}
                    {% endfor %}
               </div>
                {% else %}
            <p>No skills available</p>
        {% endif %}
            </div>
            <div class="profile-description">
            {% if isMe %}
                <div class="plus-div" id="addlanguage" data-id="4">
                <h2>Languages</h2>
                <i class="fa fa-plus plus-btn" data-id="4"></i>
                </div>
            {% endif %}
                {% if cv.languages %}
                <div> {% for lang in cv.languages %}
                    <div class="lang-btn">{{lang}}</div>{% if not forloop.last %} {% endif %}
                    {% endfor %}
               </div>
               {% else %}
                <p>No languages available</p>
            {% endif %}
            </div>
                
            <div class="profile-description">
            {% if isMe %}
                <div class="plus-div" id="addlanguage" data-id="5">
                <h2>CV</h2>
                <i class="fa fa-pencil plus-btn" data-id="5"></i>
                </div>
            {% endif %}
                {% if cv.user.user.cv %}
                    <iframe style="overflow: hidden" loading="lazy" type="application/pdf" title="PDF-file" src="{{cv.user.user.cv.url}}" width="100%" height="1100px"></iframe>
               {% else %}
                <p>No Cv available</p>
            {% endif %}
            </div>

            <div class="profile-description">
             {% for post in posts%}

            <div class="post" data-id="{{post.id}}">
                <div class="post-author">
                    {% if post.user.photo_profile %}
                    <img
                        src="{{post.user.photo_profile.url}}">
                    {% else %}
                    <img src="/media/avatar/default.jpg">
                    {% endif %}
                    <div>
                        <h1>{{post.user.user.username}}
                            {{post.user.introduction}} &middot; <span style="font-weight: lighter;">1st</span></h1>
                        <small>{{post.user.introduction}}</small>
                        <small>{{post.time_since}}</small>
                    </div>
                </div>
                <p>{{post.content}}</p>
                <img src="{{post.image.url}}" alt="profileImg"
                    width="100%">
                <div class="post-stats">
                    <div>
                        <img src="{% static 'PNP/img/thumbsup.png' %}">
                        <span class="liked-users" id="{{post.id}}">{{ post.num_likes }}  reactions</span>
                    </div>
                    <div>
                        <span>{{ post.numberComments }} comments &middot; {{ post.num_shares }} shares</span>
                    </div>
                </div>
                <div class="post-activity">

                    <div class="post-activity-link" id="like" onclick="toggleLike(this)" style="cursor: pointer;">
                        {% if post.liked == False %}
                        <img id="likeImg" src="{% static 'PNP/img/like.png' %}" class="post-activity-user-icon">
                        {% else %}
                        <img id="likeImg" src="{% static 'PNP/img/love.png' %}" class="post-activity-user-icon">
                        {% endif %}
                        <span>Like</span>
                    </div>
                    <div class="post-activity-link commentpost" onclick="openComment(this)">
                        <img src="{% static 'PNP/img/comment.png' %}" class="post-activity-user-icon">
                        <span>Comment</span>
                    </div>

                    <div class="post-activity-link">
                        <img src="{% static 'PNP/img/send.png' %}" class="post-activity-user-icon">
                        <span>Send</span>
                    </div>
                </div>
            </div>

            {% endfor %}
            </div>
            
        </div>
        <div id="modifie">
            <div class="overlay"></div>
            <div id="form-container"></div>
        </div>
        {% include "../firstPage/comments.html" %}
        <div class="profile-sidebar">
        {% if isMe %}
            <div class="sidebar-ad">
                <h1>Request</h1>
                {% for req in request_recieved %}
                <div class="sidebar-people-row">
                    <img src="{{req.user.user.photo_profile}}">
                    <div>
                        <h2>{{req.user.username}}</h2>
                        <p>{{req.user.user.introduction}}</p>
                        <a href="{% url 'PNP:accept_request' req.user.username %}">accepted</a>
                        <a href="{% url 'PNP:reject_request' req.user.username %}">rejected</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% endif %}
            <div class="sidebar-people">
                <h3>People You May Know</h3>
                {% for sugg in segguestedFriends %}
                <div class="sidebar-people-row">
                    {% if sugg.user.user.photo_profile %}
                        <img src="{{sugg.user.user.photo_profile.url}}">
                    {% else %}
                        <img src="/media/avatar/default.jpg">
                    {% endif %}
                    <div>
                        <h2>{{sugg.user.username}}</h2>
                        <p>{{sugg.user.user.introduction}}</p>
                        
                            <a href="{% url 'PNP:addFriend' sugg.user.username %}">
                            {% if sugg.user.user.Visibility == 'private' %}
                                send request
                            {% else %}
                                Connect
                            {% endif %}
                            </a>
                    </div>
                </div>
                {% endfor %}

            </div>
        </div>
    </div>
    <div class="profile-footer">
        <div class="sidebar-useful-links">
            <a href="">About</a>
            <a href="">Accesibility</a>
            <a href="">Help Center</a>
            <a href="">Privacy Policy</a>
            <a href="">Advertising</a>
            <a href="">Get the App</a>
            <a href="">More</a>
            <div class="copyright-msg">
                <img src="{% static 'PNP/img/logo.png' %}">
                <p>AzaanUllah &copy; All Rights Reserved</p>
            </div>
        </div>
    </div>
    <script src={% static 'PNP/js/formProfile.js' %}></script>
    <script>
        var profileMenu = document.getElementById('profileMenu')
        var seeMore = document.getElementById('hidden')
        function toggleMenu() {
            profileMenu.classList.toggle("open-menu");
        }
        function show() {
            if (seeMore.style.display == "none") {
                seeMore.style.display = "inline-block"
                document.getElementById('more').innerHTML = "Less..."
            }
            else {
                seeMore.style.display = "none";
                document.getElementById('more').innerHTML = "More..."
            }
        }
        document.addEventListener('click',(e)=> {
            console.log(e.target);
            var username='{{user.username}}';
            if ((e.target.classList.contains('fa-plus')) || (e.target.classList.contains('fa-pencil'))) {
                var id = e.target.dataset.id;
                document.getElementById('modifie').style.display = 'block';
                getFormData(id,username);
            }else if (e.target.classList.contains('overlay')) {
                document.getElementById('modifie').style.display = 'none';
            }

        });



        function getFormData(id,username){
            console.log("test")
            $.ajax({
                url: '/formProfile/' + id + '/'+username+'/',
                type: 'GET',
                success: function (response) {
                    console.log("secess")
                    var form = document.getElementById('form-container');
                    form.innerHTML = response;
                }
            });
        }
    </script>
    <script src="{% static 'PNP/js/gsap.min.js' %}"></script>
    
    <script>
    var section=document.getElementById('commentSection')
var overlay=document.getElementById('overlay')
function openComment(commentButton) {
    var postId = commentButton.closest('.post').dataset.id;
    fetchComments(postId);
    fetchFormComment(postId,1);
        section.classList.toggle('open-comment');
        overlay.classList.toggle('overlay-open');
}

function closeComment() {
    section.classList.remove('open-comment');
    overlay.classList.remove('overlay-open');
}

{% comment %} ajax function to fetch comments {% endcomment %}
function fetchComments(postId) {
    console.log(postId);
    $.ajax({
        url: '/comment/' + postId + '/',
        type: 'GET',
        success: function (response) {
            var commentsContainer = document.getElementById('headercomment');
            commentsContainer.innerHTML = response;
        }
    });
}

            
function addComment(itemId, type,postId) {
    var commentContent=document.getElementById('commentContent').value;
    console.log(commentContent);
        $.ajax({
            url: '/addComment/' + postId + '/'+ type + '/',
            type: 'POST',
            headers: { 'X-CSRFToken': '{{ csrf_token }}' },
            data: {
                'commentContent': commentContent,
            },
            success: function (response) {
                fetchComments(postId);
                fetchFormComment(postId,1);
            }
        });
    }
    function removeReply(){
        var replyContainer=document.getElementById('ReplyContainer');
        replyContainer.innerHTML='';
        fetchFormComment(postId,1);
    }
function fetchFormComment(itemId,type) { //type = 1 is a post and type = 2 is a comment
    $.ajax({
        url: '/showCommentForm/' + itemId + '/'+type+'/',
        type: 'GET',
        success: function (response) {
            var commentsContainer = document.getElementById('footercomment');
            commentsContainer.innerHTML = response;
        }
    });
}



    // likes

    // Define static paths
    var loveImgSrc = window.location.origin + "/static/PNP/img/love.png";
    var likeImgSrc = window.location.origin + "/static/PNP/img/like.png";
    function toggleLike(likeButton) {
    var postId = likeButton.closest('.post').dataset.id;
    var likeImg = likeButton.querySelector('img');
    var likeImgSrc = likeImg.src;
    var loveImgSrc = "{% static 'PNP/img/love.png' %}";

    if (likeImgSrc.includes('like.png')) {
        likeImg.src = loveImgSrc;
    } else {
        likeImg.src = "{% static 'PNP/img/like.png' %}";
    }

    // Make it Bouncing
    gsap.from(likeImg, {
        scale: 0.5,
        duration: 0.5,
        ease: "bounce",
    });
    
    // Send AJAX request to update the like count
    $.ajax({
        url: '/like/' + postId + '/',
        type: 'POST',
        dataType: 'json',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        success: function (response) {
            if (response.success) {
                document.querySelector('span[id=\"'+postId+'\"]').innerText = response.likes + ' reactions';
            }
        }
    });
}

 
   
        // gsap
        var posts = document.querySelectorAll('.post');
        var right_sidebar = document.querySelector('.right-sidebar');
        var left_sidebar = document.querySelector('.left-sidebar');
        var create_post = document.querySelector('.create-post');

        gsap.from(create_post, {
            opacity: 0,
            y: -100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })

        gsap.from(left_sidebar, {
            opacity: 0,
            x: -100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })

        gsap.from(right_sidebar, {
            opacity: 0,
            x: 100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })

        gsap.from(posts, {
            opacity: 0,
            y: 100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })
    </script>

{% endblock %}
