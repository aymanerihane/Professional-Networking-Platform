{% extends "base.html" %}
{% load static %}

{% block content %}
<head><link rel="stylesheet" href="{% static 'PNP/css/comment.css' %}">
<style>
.square{
    width: 50px;
    height: 50px;
    background-color: #00838D;
}

</style>
</head>
<div class="container">
    <!-- --popup -->
    <div class="popup-container" id="popup">
        <div class="header">
            <img src="{% static 'PNP/img/logo.png' %}">
            <h1>Welcome to LinkedIn</h1>
        </div>
        {{form}}
        <div class="buttons-container"> 
            {% if form_is_valid %}
                <button onclick="popup()">Discard</button>
                <button type='submit' onclick="add()">Post</button>
                <h1>Form is valid</h1>
            {% else %}
                <button onclick="popup()">Discard</button>
                <button type='submit' style="background-color: #efefef;color: black;cursor: not-allowed;" onclick="add()" disabled>Post</button>
                <h1>Form is not valid</h1>
            {% endif %}

        </div>
    </div>
    <!-- --popup ended-->
    <div class="container">
        <div class="left-sidebar">
            <div class="sidebar-profile-box">
                <img src="{% static 'PNP/img/avatar/defaultBgc.jpg' %}"
                    width="100%" class="cover-img">
                <div class="sidebar-profile-info">
                    {% if user and user.photo_profile %}
                        <img src="{{ user.photo_profile.url }}">
                    {% else %}
                        <img src="{% static 'PNP/img/avatar/default.jpg' %}">
                    {% endif %}
                    <h1>{{user.username}}</h1>
                    <h3>Student at Saylani Mass IT Train -ing, Web & App</h3>
                    <ul>
                        <li>Your Profile Views<span>100</span></li>
                        <li>Your Post Views<span>370</span></li>
                        <li>Your Connections<span>1K</span></li>
                    </ul>
                </div>
            </div>
            <div class="sidebar-activity" id="sidebarActivity">
                <h3>RECENT</h3>
                <a href=""><img src="{% static 'PNP/img/recent.png' %}">Web Development</a>
                <a href=""><img src="{% static 'PNP/img/recent.png' %}">User Interface</a>
                <a href=""><img src="{% static 'PNP/img/recent.png' %}">Online Learning</a>
                <a href=""><img src="{% static 'PNP/img/recent.png' %}">Learn Online</a>
                <a href=""><img src="{% static 'PNP/img/recent.png' %}">Code Better</a>
                <a href=""><img src="{% static 'PNP/img/recent.png' %}">Group Learning</a>
                <h3>GROUPS</h3>
                <a href=""><img src="{% static 'PNP/img/group.png' %}">Saylani Mass It Tranining</a>
                <a href=""><img src="{% static 'PNP/img/group.png' %}">The Perfect Dev</a>
                <a href=""><img src="{% static 'PNP/img/group.png' %}">Techno Kids</a>
                <a href=""><img src="{% static 'PNP/img/group.png' %}">Web and App Development</a>
                <h3>HASHTAGS</h3>
                <a href=""><img src="{% static 'PNP/img/hashtag.png' %}">webdevelopment</a>
                <a href=""><img src="{% static 'PNP/img/hashtag.png' %}">letsconnect!</a>
                <a href=""><img src="{% static 'PNP/img/hashtag.png' %}">pakistanzindabad</a>
                <div class="discover-more-link">
                    <a href="">Discover More</a>
                </div>
            </div>
            <p id="showMoreLink" onclick="showSideBar()">Show More <b>+</b></p>
        </div>
        <div class="main-content" id="main">
            <div class="create-post">
                <div class="create-post-input">
                    <img
                        src="media/avat">
                    <textarea name='content' placeholder="What\'s on your mind?"></textarea>
                </div>
                <div class="create-post-links">
                    <li><img src="{% static 'PNP/img/photo.png' %}">Photo</li>
                    <li><img src="{% static 'PNP/img/video.png' %}">Video</li>
                    <li><img src="{% static 'PNP/img/event.png' %}">Event</li>
                    <li onclick="popup()">Post</li>
                </div>
            </div>
            {% comment %} <div class="sort-by">
                <hr>
                <p>Sort By: <span>Top <img src="{% static 'PNP/img/down-arrow.png' %}" alt=""></span></p>
            </div> {% endcomment %}
            <!-- allposts -->
            {% for post in posts%}

            <div class="post" data-id="{{post.id}}">
                <div class="post-author">
                    <img
                        src="https://media.licdn.com/dms/image/D4D35AQGTdqs4cZFOBw/profile-framedphoto-shrink_200_200/0/1680180892982?e=1685826000&v=beta&t=YRCXIxlGFtfR7g0RpxDyhjohxxDavabl4WrjU3tRM94">
                    <div>
                        <h1>{{post.user.user.username}}
                            Developer &middot; <span style="font-weight: lighter;">1st</span></h1>
                        <small>Web Developer | Free-Lancer</small>
                        <small>2 hours ago</small>
                    </div>
                </div>
                <p>{{post.content}}</p>
                <img src="{{post.image.url}}" alt="profileImg"
                    width="100%">
                <div class="post-stats">
                    <div>
                        <img src="{% static 'PNP/img/thumbsup.png' %}">
                        <span class="liked-users" id="{{post.id}}">{{ post.num_likes }}  reactions</span>
                    </div>
                    <div>
                        <span>{{ post.num_comments }} comments &middot; {{ post.num_shares }} shares</span>
                    </div>
                </div>
                <div class="post-activity">

                    <div class="post-activity-link" id="like" onclick="toggleLike(this)" style="cursor: pointer;">
                        <img id="likeImg" src="{% static 'PNP/img/like.png' %}" class="post-activity-user-icon">
                        <span>Like</span>
                    </div>
                    <div class="post-activity-link" id="comment">
                        <img src="{% static 'PNP/img/comment.png' %}" class="post-activity-user-icon">
                        <span>Comment</span>
                    </div>
                    <div class="post-activity-link">
                        <img src="{% static 'PNP/img/share.png' %}" class="post-activity-user-icon">
                        <span>Share</span>
                    </div>
                    <div class="post-activity-link">
                        <img src="{% static 'PNP/img/send.png' %}" class="post-activity-user-icon">
                        <span>Send</span>
                    </div>
                </div>
            </div>

            {% endfor %}
        </div>
        <div class="right-sidebar">
            <div class="sidebar-news">
                <img src="{% static 'PNP/img/more.png' %}" class="info-icon">
                <h3>Trending News</h3>
                <a href="">High demand for skilled manpower</a>
                <span>1d ago &middot; 1934 readers</span>
                <a href="">Carrier growing horizontally too</a>
                <span>10d ago &middot; 1084 readers</span>
                <a href="">Less work visa for US, more for UK</a>
                <span>7h ago &middot; 7980 readers</span>
                <a href="">More hiring = Higher confidence ?</a>
                <span>1h ago &middot; 1924 readers</span>
                <a href="">Saylani has announced batch 4 of Techno Kids</a>
                <span>8h ago &middot; 1906 readers</span>
                <a href="" class="read-more-link">Read More</a>
            </div>
            <div class="sidebar-ad">
                <small>AD &middot; &middot; &middot;</small>
                <p>Master the 5 principles of web design</p>
                <div>
                    {% if user.photo_profile %}
                    <img src="{{ user.photo_profile.url }}" alt="">
                    {% else %}
                    <img src="{% static 'PNP/img/avatar/default.jpg' %}" alt="">
                    {% endif %}
                </div>
                <b>Share Your Experience With Saylani</b>
                <a href="https://www.linkedin.com/feed/update/urn:li:activity:7068264850904293377/" class="ad-link" target="_blank">Learn More</a>
            </div>
            <div class="sidebar-useful-links">
                <a href="">About</a>
                <a href="">Accesibility</a>
                <a href="">Help Center</a>
                <a href="">Privacy Policy</a>
                <a href="">Advertising</a>
                <a href="">Get the App</a>
                <a href="">More</a>
                <div class="copyright-msg">
                    <img src="{% static 'PNP/img/logo.png' %}">
                    <p>AzaanUllah &copy; All Rights Reserved</p>
                </div>
            </div>
        </div>
    </div>
    {% include "./comments.html" %}
    {% comment %} upload gsap framwork {% endcomment %}
    <script src="{% static 'PNP/js/gsap.min.js' %}"></script>

    <script src="{% static 'PNP/js/firstPage.js' %}"></script>
    <script src="{% static 'PNP/js/jquery-3.7.1.min.js' %}"></script>

    
    <script>
    // likes

    // Define static paths
    var loveImgSrc = window.location.origin + "/static/PNP/img/love.png";
    var likeImgSrc = window.location.origin + "/static/PNP/img/like.png";
    function toggleLike(likeButton) {
    var postId = likeButton.closest('.post').dataset.id;
    var likeImg = likeButton.querySelector('img');
    var likeImgSrc = likeImg.src;
    var loveImgSrc = "{% static 'PNP/img/love.png' %}";

    if (likeImgSrc.includes('like.png')) {
        likeImg.src = loveImgSrc;
    } else {
        likeImg.src = "{% static 'PNP/img/like.png' %}";
    }

    // Make it Bouncing
    gsap.from(likeImg, {
        scale: 0.5,
        duration: 0.5,
        ease: "bounce",
    });
    
    // Send AJAX request to update the like count
    $.ajax({
        url: '/like/' + postId + '/',
        type: 'POST',
        dataType: 'json',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        success: function (response) {
            if (response.success) {
                console.log(response.likes);
                document.querySelector('span[id=\"'+postId+'\"]').innerText = response.likes + ' reactions';
            }
        }
    });
}

 
   
        // gsap
        var posts = document.querySelectorAll('.post');
        var right_sidebar = document.querySelector('.right-sidebar');
        var left_sidebar = document.querySelector('.left-sidebar');
        var create_post = document.querySelector('.create-post');

        gsap.from(create_post, {
            opacity: 0,
            y: -100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })

        gsap.from(left_sidebar, {
            opacity: 0,
            x: -100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })

        gsap.from(right_sidebar, {
            opacity: 0,
            x: 100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })

        gsap.from(posts, {
            opacity: 0,
            y: 100,
            duration: 1,
            ease: "power2.Out",
            delay: 0.5,
        })
    </script>

</div>
{% endblock content %}